{"ast":null,"code":"import _defineProperty from\"/Users/intvirtue/Last-final/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _toConsumableArray from\"/Users/intvirtue/Last-final/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/intvirtue/Last-final/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/intvirtue/Last-final/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/intvirtue/Last-final/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/intvirtue/Last-final/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3;import React,{useEffect,useState,useRef}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{connect}from\"./redux/blockchain/blockchainActions\";import{fetchData}from\"./redux/data/dataActions\";import*as s from\"./styles/globalStyles\";import styled from\"styled-components\";import{create}from\"ipfs-http-client\";import SignatureCanvas from\"react-signature-canvas\";import Navbar from'./Navbar';import background from\"./assests/bg/background.png\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ipfsClient=create(\"https://ipfs.infura.io:5001/api/v0\");export var StyledButton=styled.button(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  padding: 8px;\\n\"])));export var ResponsiveWrapper=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex: 1;\\n  flex-direction: column;\\n  justify-content: stretched;\\n  align-items: stretched;\\n  width: 100%;\\n  @media (min-width: 767px) {\\n    flex-direction: row;\\n  }\\n\"])));export var StyledImg=styled.img(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  width: 200px;\\n  height: 200px;\\n  @media (min-width: 767px) {\\n    width: 350px;\\n    height: 350px;\\n  }\\n  transition: width 0.5s;\\n  transition: height 0.5s;\\n\"])));function App(){var _jsx2;var dispatch=useDispatch();var blockchain=useSelector(function(state){return state.blockchain;});var data=useSelector(function(state){return state.data;});var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(\"Sign or draw something and click on MINT\"),_useState4=_slicedToArray(_useState3,2),feedback=_useState4[0],setFeedback=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),NFTS=_useState6[0],setNFTS=_useState6[1];var elementRef=useRef();var ipfsBaseUrl=\"https://ipfs.infura.io/ipfs/\";var name=\"Good NFT\";var description=\"A donation made by minting an NFT\";console.log(NFTS);var mint=function mint(_uri){setFeedback(\"Minting your GoodNFT...\");blockchain.smartContract.methods.mint(blockchain.account,_uri).send({from:blockchain.account,value:10000000000000000}).once(\"error\",function(err){console.log(err);setLoading(false);setFeedback(\"Sorry, something went wrong please try again later.\");}).then(function(receipt){console.log(receipt);setLoading(false);clearCanvas();dispatch(fetchData(blockchain.account));setFeedback(\"Successfully minting your NFT, Thank you for your donation\");});};var createMetaDataAndMint=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_name,_des,_imgBuffer){var addedImage,metaDataObj,addedMetaData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);setFeedback(\"Minting Your NFT\");_context.prev=2;_context.next=5;return ipfsClient.add(_imgBuffer);case 5:addedImage=_context.sent;metaDataObj={name:_name,description:_des,image:ipfsBaseUrl+addedImage.path};_context.next=9;return ipfsClient.add(JSON.stringify(metaDataObj));case 9:addedMetaData=_context.sent;console.log(ipfsBaseUrl+addedMetaData.path);mint(ipfsBaseUrl+addedMetaData.path);_context.next=19;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](2);console.log(_context.t0);setLoading(false);setFeedback(\"Error\");case 19:case\"end\":return _context.stop();}}},_callee,null,[[2,14]]);}));return function createMetaDataAndMint(_x,_x2,_x3){return _ref.apply(this,arguments);};}();var startMintingProcess=function startMintingProcess(){createMetaDataAndMint(name,description,getImageData());};var getImageData=function getImageData(){var canvasEl=elementRef.current;var dataUrl=canvasEl.toDataURL(\"image/png\");var buffer=Buffer(dataUrl.split(\",\")[1],\"base64\");return buffer;};var fetchMetatDataForNFTS=function fetchMetatDataForNFTS(){setNFTS([]);data.allTokens.forEach(function(nft){fetch(nft.uri).then(function(response){return response.json();}).then(function(metaData){setNFTS(function(prevState){return[].concat(_toConsumableArray(prevState),[{id:nft.id,metaData:metaData}]);});}).catch(function(err){console.log(err);});});};var clearCanvas=function clearCanvas(){var canvasEl=elementRef.current;canvasEl.clear();};useEffect(function(){if(blockchain.account!==\"\"&&blockchain.smartContract!==null){dispatch(fetchData(blockchain.account));}},[blockchain.smartContract,dispatch]);useEffect(function(){fetchMetatDataForNFTS();},[data.allTokens]);return/*#__PURE__*/_jsxs(s.Screen,{image:background,style:{backgroundColor:\"var(--yellow)\"},children:[/*#__PURE__*/_jsxs(s.Container,{flex:1,ai:\"center\",style:{padding:24},children:[/*#__PURE__*/_jsx(Navbar,{}),/*#__PURE__*/_jsx(s.SpacerMedium,{}),/*#__PURE__*/_jsxs(s.TextTitle,{children:[\"Account:\",blockchain.account]})]}),/*#__PURE__*/_jsxs(s.Container,{flex:1,ai:\"center\",style:{padding:24},children:[/*#__PURE__*/_jsx(s.TextTitle,{style:{textAlign:\"center\",fontSize:28,fontWeight:\"bold\"},children:\"Mint your GoodNFT...and make a donation\"}),/*#__PURE__*/_jsx(s.SpacerMedium,{}),/*#__PURE__*/_jsx(s.TextTitle,{style:{textAlign:\"center\",fontSize:28,fontWeight:\"bold\"},children:\"We appreciate that you thought of us!\"}),/*#__PURE__*/_jsx(s.SpacerMedium,{}),/*#__PURE__*/_jsxs(s.TextTitle,{style:{textAlign:\"center\",fontSize:35,fontWeight:\"bold\"},children:[\"NFTs Minted: \",data.totalSupply,\" out of 50\"]}),/*#__PURE__*/_jsx(s.SpacerMedium,{}),/*#__PURE__*/_jsx(s.Container,{flex:1,jc:\"center\",ai:\"center\",style:{backgroundColor:\"#383838\",padding:24},children:Number(data.totalSupply)==50?/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(s.TextTitle,{style:{textAlign:\"center\"},children:\"The donation has ended.\"})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(s.TextTitle,{style:{textAlign:\"center\"},children:\"Donation costs 0.01 ETH per NFT\"}),/*#__PURE__*/_jsx(s.SpacerXSmall,{}),/*#__PURE__*/_jsx(s.SpacerXSmall,{}),/*#__PURE__*/_jsx(s.TextDescription,{style:{textAlign:\"center\",fontSize:22},children:feedback}),/*#__PURE__*/_jsx(s.SpacerSmall,{}),/*#__PURE__*/_jsx(s.SpacerMedium,{}),blockchain.account===\"\"||blockchain.smartContract===null?/*#__PURE__*/_jsxs(s.Container,{ai:\"center\",jc:\"center\",children:[/*#__PURE__*/_jsx(s.TextDescription,{style:{textAlign:\"center\"},children:\"Connect Your Wallet\"}),/*#__PURE__*/_jsx(s.SpacerSmall,{}),/*#__PURE__*/_jsx(StyledButton,{onClick:function onClick(e){e.preventDefault();dispatch(connect());},children:\"CONNECT\"}),blockchain.errorMsg!==\"\"?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(s.SpacerSmall,{}),/*#__PURE__*/_jsx(s.TextDescription,{style:{textAlign:\"center\"},children:blockchain.errorMsg})]}):null]}):/*#__PURE__*/_jsxs(s.Container,{flex:1,ai:\"center\",style:{padding:24},children:[/*#__PURE__*/_jsxs(s.Container,{ai:\"center\",jc:\"center\",fd:\"row\",children:[/*#__PURE__*/_jsx(StyledButton,{disabled:loading?1:0,onClick:function onClick(e){e.preventDefault();startMintingProcess();},children:\"MINT\"}),/*#__PURE__*/_jsx(s.SpacerSmall,{}),/*#__PURE__*/_jsx(StyledButton,{disabled:loading?1:0,onClick:function onClick(e){e.preventDefault();clearCanvas();},children:\"CLEAR\"}),/*#__PURE__*/_jsx(s.SpacerLarge,{})]}),/*#__PURE__*/_jsx(s.SpacerLarge,{}),/*#__PURE__*/_jsx(SignatureCanvas,{backgroundColor:\"#4f8edb\",canvasProps:{width:350,height:350},ref:elementRef}),/*#__PURE__*/_jsx(s.SpacerLarge,{}),/*#__PURE__*/_jsx(s.Container,(_jsx2={flex:1,jc:\"center\",ai:\"center\",style:{width:\"70%\"},fd:\"row\"},_defineProperty(_jsx2,\"style\",{flexWrap:\"wrap\"}),_defineProperty(_jsx2,\"children\",data.loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(s.SpacerSmall,{}),/*#__PURE__*/_jsx(s.TextDescription,{style:{textAlign:\"center\"},children:\"loading...\"})]}):NFTS.map(function(nft,index){return/*#__PURE__*/_jsxs(s.Container,{style:{padding:16},children:[/*#__PURE__*/_jsx(s.TextTitle,{children:nft.metaData.name}),/*#__PURE__*/_jsx(s.SpacerSmall,{}),/*#__PURE__*/_jsx(\"img\",{alt:nft.metaData.name,src:nft.metaData.image,width:150})]},index);})),_jsx2)),\".\"]})]})}),/*#__PURE__*/_jsx(s.SpacerSmall,{}),/*#__PURE__*/_jsxs(s.Container,{jc:\"center\",ai:\"center\",style:{width:\"70%\"},children:[/*#__PURE__*/_jsx(s.TextDescription,{style:{textAlign:\"center\",fontSize:15},children:\"This project is built for the consensys bootcamp final project, and\"}),/*#__PURE__*/_jsx(s.SpacerSmall,{}),/*#__PURE__*/_jsx(s.TextDescription,{style:{textAlign:\"center\",fontSize:15},children:\"It is an experiment to make a donation through minting your drawing or signiture as an NFT and upload it to IPFS\"})]})]})]});}export default App;","map":{"version":3,"sources":["/Users/intvirtue/Last-final/src/App.js"],"names":["React","useEffect","useState","useRef","useDispatch","useSelector","connect","fetchData","s","styled","create","SignatureCanvas","Navbar","background","ipfsClient","StyledButton","button","ResponsiveWrapper","div","StyledImg","img","App","dispatch","blockchain","state","data","loading","setLoading","feedback","setFeedback","NFTS","setNFTS","elementRef","ipfsBaseUrl","name","description","console","log","mint","_uri","smartContract","methods","account","send","from","value","once","err","then","receipt","clearCanvas","createMetaDataAndMint","_name","_des","_imgBuffer","add","addedImage","metaDataObj","image","path","JSON","stringify","addedMetaData","startMintingProcess","getImageData","canvasEl","current","dataUrl","toDataURL","buffer","Buffer","split","fetchMetatDataForNFTS","allTokens","forEach","nft","fetch","uri","response","json","metaData","prevState","id","catch","clear","backgroundColor","padding","textAlign","fontSize","fontWeight","totalSupply","Number","e","preventDefault","errorMsg","width","height","flexWrap","map","index"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { connect } from \"./redux/blockchain/blockchainActions\";\nimport { fetchData } from \"./redux/data/dataActions\";\nimport * as s from \"./styles/globalStyles\";\nimport styled from \"styled-components\";\nimport { create } from \"ipfs-http-client\";\nimport SignatureCanvas from \"react-signature-canvas\";\nimport Navbar from './Navbar'\nimport background from \"./assests/bg/background.png\";\n\n\n\nconst ipfsClient = create(\"https://ipfs.infura.io:5001/api/v0\");\n\nexport const StyledButton = styled.button`\n  padding: 8px;\n`;\nexport const ResponsiveWrapper = styled.div`\n  display: flex;\n  flex: 1;\n  flex-direction: column;\n  justify-content: stretched;\n  align-items: stretched;\n  width: 100%;\n  @media (min-width: 767px) {\n    flex-direction: row;\n  }\n`;\nexport const StyledImg = styled.img`\n  width: 200px;\n  height: 200px;\n  @media (min-width: 767px) {\n    width: 350px;\n    height: 350px;\n  }\n  transition: width 0.5s;\n  transition: height 0.5s;\n`;\n\nfunction App() {\n  const dispatch = useDispatch();\n  const blockchain = useSelector((state) => state.blockchain);\n  const data = useSelector((state) => state.data);\n  const [loading, setLoading] = useState(false);\n  const [feedback, setFeedback] = useState(\"Sign or draw something and click on MINT\");\n  const [NFTS, setNFTS] = useState([]);\n  const elementRef = useRef();\n  \n  \n  const ipfsBaseUrl = \"https://ipfs.infura.io/ipfs/\";\n  const name = \"Good NFT\";\n  const description = \"A donation made by minting an NFT\";\n  \n  console.log(NFTS);\n\n  const mint = (_uri) => {\n    setFeedback(\"Minting your GoodNFT...\");\n    blockchain.smartContract.methods\n      .mint(blockchain.account, _uri)\n      .send({ from: blockchain.account, value: 10000000000000000})\n      .once(\"error\", (err) => {\n        console.log(err);\n        setLoading(false);\n        setFeedback(\"Sorry, something went wrong please try again later.\");\n      })\n      .then((receipt) => {\n        console.log(receipt);\n        setLoading(false);\n        clearCanvas();\n        dispatch(fetchData(blockchain.account));\n        setFeedback(\"Successfully minting your NFT, Thank you for your donation\");\n      });\n  };\n\n  const createMetaDataAndMint = async (_name, _des, _imgBuffer) => {\n    setLoading(true);\n    setFeedback(\"Minting Your NFT\");\n    try {\n      const addedImage = await ipfsClient.add(_imgBuffer);\n      const metaDataObj = {\n        name: _name,\n        description: _des,\n        image: ipfsBaseUrl + addedImage.path,\n      };\n      const addedMetaData = await ipfsClient.add(JSON.stringify(metaDataObj));\n      console.log(ipfsBaseUrl + addedMetaData.path);\n      mint(ipfsBaseUrl + addedMetaData.path);\n    } catch (err) {\n      console.log(err);\n      setLoading(false);\n      setFeedback(\"Error\");\n    }\n  };\n\n  const startMintingProcess = () => {\n    createMetaDataAndMint(name, description, getImageData());\n  };\n\n  const getImageData = () => {\n    const canvasEl = elementRef.current;\n    let dataUrl = canvasEl.toDataURL(\"image/png\");\n    const buffer = Buffer(dataUrl.split(\",\")[1], \"base64\");\n    return buffer;\n  };\n\n  const fetchMetatDataForNFTS = () => {\n    setNFTS([]);\n    data.allTokens.forEach((nft) => {\n      fetch(nft.uri)\n        .then((response) => response.json())\n        .then((metaData) => {\n          setNFTS((prevState) => [\n            ...prevState,\n            { id: nft.id, metaData: metaData },\n          ]);\n        })\n        .catch((err) => {\n          console.log(err);\n        });\n    });\n  };\n\n  const clearCanvas = () => {\n    const canvasEl = elementRef.current;\n    canvasEl.clear();\n  };\n\n  useEffect(() => {\n    if (blockchain.account !== \"\" && blockchain.smartContract !== null) {\n      dispatch(fetchData(blockchain.account));\n    }\n  }, [blockchain.smartContract, dispatch]);\n\n  useEffect(() => {\n    fetchMetatDataForNFTS();\n  }, [data.allTokens]);\n\n  return (\n    <s.Screen image={background} style={{ backgroundColor: \"var(--yellow)\" }}>\n      <s.Container flex={1} ai={\"center\"} style={{ padding: 24 }} >\n       <Navbar />\n       <s.SpacerMedium />\n       <s.TextTitle\n          \n        >\n          Account:{blockchain.account}\n          \n        </s.TextTitle>\n      </s.Container>\n      <s.Container flex={1} ai={\"center\"} style={{ padding: 24 }}>\n        <s.TextTitle\n          style={{ textAlign: \"center\", fontSize: 28, fontWeight: \"bold\" }}\n        >\n          Mint your GoodNFT...and make a donation\n        </s.TextTitle>\n        <s.SpacerMedium />\n        <s.TextTitle\n          style={{ textAlign: \"center\", fontSize: 28, fontWeight: \"bold\" }}\n        >\n          We appreciate that you thought of us!\n        </s.TextTitle>\n        <s.SpacerMedium />\n           \n            <s.TextTitle \n              style={{ textAlign: \"center\", fontSize: 35, fontWeight: \"bold\" }}\n            >\n              NFTs Minted: {data.totalSupply} out of 50\n            </s.TextTitle>\n          \n          <s.SpacerMedium />\n          <s.Container\n            flex={1}\n            jc={\"center\"}\n            ai={\"center\"}\n            style={{ backgroundColor: \"#383838\", padding: 24 }}\n          >\n            {Number(data.totalSupply) == 50 ? (\n              <>\n                <s.TextTitle style={{ textAlign: \"center\" }}>\n                  The donation has ended.\n                </s.TextTitle>\n              </>\n            ) : (\n              <>\n                <s.TextTitle style={{ textAlign: \"center\" }}>\n                  Donation costs 0.01 ETH per NFT\n                </s.TextTitle>\n                <s.SpacerXSmall />\n                \n                <s.SpacerXSmall />\n                <s.TextDescription style={{ textAlign: \"center\", fontSize: 22}}>\n                  {feedback}\n                </s.TextDescription>\n                <s.SpacerSmall />\n                <s.SpacerMedium />\n                {blockchain.account === \"\" ||\n                blockchain.smartContract === null ? (\n                  <s.Container ai={\"center\"} jc={\"center\"}>\n                    <s.TextDescription style={{ textAlign: \"center\" }}>\n                      Connect Your Wallet \n                    </s.TextDescription>\n                    <s.SpacerSmall />\n                    <StyledButton\n                      onClick={(e) => {\n                        e.preventDefault();\n                        dispatch(connect());\n                      }}\n                    >\n                      CONNECT\n                    </StyledButton>\n                    {blockchain.errorMsg !== \"\" ? (\n                      <>\n                        <s.SpacerSmall />\n                        <s.TextDescription style={{ textAlign: \"center\" }}>\n                          {blockchain.errorMsg}\n                        </s.TextDescription>\n                      </>\n                    ) : null}\n                  </s.Container>\n                ) : (\n                  <s.Container flex={1} ai={\"center\"} style={{ padding: 24 }}>\n                    \n                    <s.Container ai={\"center\"} jc={\"center\"} fd={\"row\"}>\n                    <StyledButton\n                      disabled={loading ? 1 : 0}\n                      onClick={(e) => {\n                        e.preventDefault();\n                        startMintingProcess();\n                      }}\n                    >\n            MINT\n            </StyledButton>\n            <s.SpacerSmall />\n            <StyledButton\n              disabled={loading ? 1 : 0}\n              onClick={(e) => {\n                e.preventDefault();\n                clearCanvas();\n              }}\n            >\n              CLEAR\n            </StyledButton>\n            <s.SpacerLarge />\n            </s.Container>\n            <s.SpacerLarge />\n          <SignatureCanvas\n            backgroundColor={\"#4f8edb\"}\n            canvasProps={{ width: 350, height: 350 }}\n            ref={elementRef}\n          />\n          <s.SpacerLarge />\n          <s.Container flex={1} jc={\"center\"} ai={\"center\"} style={{ width: \"70%\" }} fd={\"row\"} style={{ flexWrap: \"wrap\" }}>\n        {data.loading ? (\n            <>\n              <s.SpacerSmall />\n              <s.TextDescription style={{ textAlign: \"center\" }}>\n                loading...\n              </s.TextDescription>\n            </>\n          ) : (\n            NFTS.map((nft, index) => {\n              return (\n                <s.Container key={index} style={{ padding: 16 }}>\n                  <s.TextTitle >{nft.metaData.name}</s.TextTitle>\n                  <s.SpacerSmall />\n                  <img\n                    alt={nft.metaData.name}\n                    src={nft.metaData.image}\n                    width={150}\n                  />\n                </s.Container>\n              );\n            })\n          )}\n        </s.Container>.\n      </s.Container>\n          \n                )}\n              </>\n            )}\n      </s.Container>          \n        <s.SpacerSmall />\n        <s.Container jc={\"center\"} ai={\"center\"} style={{ width: \"70%\" }}>\n          <s.TextDescription style={{ textAlign: \"center\", fontSize: 15}}>\n            This project is built for the consensys bootcamp final project, and \n          </s.TextDescription>\n          <s.SpacerSmall />\n          <s.TextDescription style={{ textAlign: \"center\", fontSize: 15 }}>\n            It is an experiment to make a donation through minting your drawing or signiture as an NFT and upload it to IPFS\n          </s.TextDescription>\n        </s.Container>\n      </s.Container>\n    </s.Screen>\n  );\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}